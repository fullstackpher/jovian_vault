---
problem: "UniApp小程序分享图片生成慢"
environment: [UniApp, Canvas, 小程序]
solved_date: 2024-01-01
tags: [性能优化, UniApp]
---

## 🔍 问题描述
生成分享图片时，绘制大量元素导致卡顿，耗时3-4秒。

## 💡 解决方案
### 优化前
```javascript
// 原始代码 - 串行绘制
ctx.drawImage(image1, 0, 0)
ctx.drawImage(image2, 0, 0)
// ... 更多绘制
```


### 优化后

```javascript
// 1. 使用离屏Canvas预渲染
const offscreen = wx.createOffscreenCanvas()

// 2. 图片压缩+缓存
const compressed = await compressImage(original)

// 3. 分帧渲染
function drawFrame(frame) {
  requestAnimationFrame(() => {
    // 每帧绘制部分内容
  })
}
```

## 📊 效果对比

| 指标   | 优化前    | 优化后   |
| ---- | ------ | ----- |
| 生成时间 | 3500ms | 800ms |
| 内存占用 | 高      | 降低60% |
| 用户体验 | 卡顿     | 流畅    |

## 🎯 核心技巧

1. **离屏渲染**减少主线程压力

2. **资源预加载**避免等待

3. **分帧处理**保持响应


## 🔗 相关技术

- [[Canvas性能优化]]

- [[小程序最佳实践]]